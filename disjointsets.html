<html><head><title>dogs</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="org.typelevel" /><meta name="description" content="pure functional data structures for Scala" /><meta name="og:image" content="/dogs/img/poster.png" /><meta name="og:title" content="dogs" /><meta name="og:site_name" content="dogs" /><meta name="og:url" content="https://stew.github.io/dogs/" /><meta name="og:type" content="website" /><meta name="og:description" content="pure functional data structures for Scala" /><link rel="icon" type="image/png" href="/dogs/img/favicon.png" /><meta name="twitter:title" content="dogs" /><meta name="twitter:image" content="https://stew.github.io/dogs/img/poster.png" /><meta name="twitter:description" content="pure functional data structures for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/dogs/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/dogs/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/dogs/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/dogs/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/dogs/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/dogs/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/dogs/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/dogs/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/dogs/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/dogs/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/dogs/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/dogs/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/dogs/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/dogs/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/dogs/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/dogs/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/dogs/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/dogs/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/dogs/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/dogs/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/dogs/highlight/styles/default.css" /><link rel="stylesheet" href="/dogs/css/style.css" /><link rel="stylesheet" href="/dogs/css/palette.css" /><link rel="stylesheet" href="/dogs/css/codemirror.css" /><link rel="stylesheet" href="/dogs/css/kazari-style.css" /><link rel="stylesheet" href="/dogs/css/monokai.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/dogs/" class="brand"><div class="brand-wrapper"><span>dogs</span></div></a></li> <li><a href="/dogs/index.html" class="">Home</a></li> <li><a href="/dogs/binaryheap.html" class="">Binary Heap</a></li> <li><a href="/dogs/dequeue.html" class="">Dequeue</a></li> <li><a href="/dogs/diet.html" class="">Diet</a></li> <li><a href="/dogs/disjointsets.html" class="">Disjoin Sets</a></li> <li><a href="/dogs/enum.html" class="">Enum</a></li> <li><a href="/dogs/iset.html" class="">ISet</a></li> <li><a href="/dogs/range.html" class="">Range</a></li> <li><a href="/dogs/set.html" class="">Set</a></li> <li><a href="/dogs/streaming.html" class="">Streaming</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/stew/dogs"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/stew/dogs"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('dogs pure functional data structures for Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('dogs pure functional data structures for Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="stew" data-github-repo="dogs"><div class="content-wrapper"><section><h1 id="disjoint-sets">Disjoint Sets</h1>

<p><code class="highlighter-rouge">DisjointSets</code> provides a purely functional implementation for the union-find collection. 
An Union-Find (aka Disjoint Sets) structure is a set of sets where the intersection of any two sets is empty.</p>

<p><img src="http://i.imgur.com/K7BwoOk.png" alt="" /></p>

<p><img src="http://i.imgur.com/SkqEdwt.png" alt="" /></p>

<p>This constraint opens the way to fast unions (<code class="highlighter-rouge">O(1)</code> average). That makes of Disjoint Sets the perfect tool for
 clustering algorithms such as calculating the connected components in a graph.</p>

<p>Initially, it is a flat collection where each element forms its own, size 1, disjoint set.
New elements are added as new disjoint sets and union operations can be used to fusion these sets.
The joined sets are represented by one of its elements known as <strong><em>label</em> or <em>root</em></strong>.</p>

<p>Fast fusion of disjoints sets is key and its provided through parenthood relations. Sets <code class="highlighter-rouge">labels</code> are always the 
top-level ancestor.</p>

<p>The following example shows 3 disjoint sets of size 1.</p>

<p><img src="http://i.imgur.com/h8ddOkT.png" alt="" /></p>

<p>Whereas, in the next one, <code class="highlighter-rouge">C</code> is the parent of the <code class="highlighter-rouge"><span class="p">{</span><span class="err">A,</span><span class="w"> </span><span class="err">B,</span><span class="w"> </span><span class="err">C</span><span class="p">}</span></code> set which is the only set in the DisjointSets structure.</p>

<p><img src="http://i.imgur.com/V71Z0eS.png" alt="" /></p>

<h2 id="supported-operations">Supported operations</h2>

<ul>
  <li><code class="highlighter-rouge">dsets + c</code> (add): Adds a value as a single element set:</li>
</ul>

<p><img src="http://i.imgur.com/iA00VgQ.png" alt="" /></p>

<ul>
  <li><code class="highlighter-rouge">desets.union(A,C)</code> (union/join): Fusion two disjoint sets:</li>
</ul>

<p><img src="http://i.imgur.com/7uunsNJ.png" alt="" /></p>

<ul>
  <li>
    <p><code class="highlighter-rouge">dsets.find(v)</code> (find): Retrieves <code class="highlighter-rouge">Some(label)</code> if <code class="highlighter-rouge">v</code> belongs to the set with that label or <code class="highlighter-rouge">None</code> if the 
value is not part of <code class="highlighter-rouge">dsets</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">dsets.toSets</code>: Gets a <code class="highlighter-rouge">Map[T, Set[T]]</code> representation of the DisjointSets contents where the key is each set 
<em>label</em>.</p>
  </li>
</ul>

<h2 id="example-usage">Example usage</h2>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">DisjointSets._</span>

<span class="k">val</span> <span class="n">operations</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">union</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span>
  <span class="n">oneAndTwo</span> <span class="k">&lt;-</span> <span class="n">find</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">union</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">)</span>
  <span class="n">threeAndFour</span> <span class="k">&lt;-</span> <span class="n">find</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">union</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">)</span>
  <span class="n">sets</span> <span class="k">&lt;-</span> <span class="n">toSets</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">sets</span>

<span class="k">val</span> <span class="n">label2disjointset</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Set</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span> <span class="n">operations</span><span class="o">.</span><span class="n">runA</span><span class="o">(</span><span class="nc">DisjointSets</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">)).</span><span class="n">value</span>
</code></pre>
</div>

<h2 id="structure-and-performance">Structure and performance</h2>

<p>The main idea is that each element starts as a disjoint set itself. A set with two or more elements is always the result of one or several <em>union</em> operations. Thus, a multi-element set is composed of sets of just one element, call them components.</p>

<p>Each component has 3 fields:</p>

<ul>
  <li>One for the value of the element it contains.</li>
  <li>A reference pointing to another component of the same composed multi-element set. Or itself if it constitutes a single element set.</li>
  <li>An estimation of how many components/nodes compose its descendants. This estimation is known as <strong>rank</strong>.</li>
</ul>

<p>Let’s assume that the next operations are executed:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>dsets.union(B,A) //1
dsets.union(B,C) //2
</code></pre>
</div>

<p>From a mathematical point of view, the result should be similar to the one shown below:</p>

<p><img src="http://i.imgur.com/V71Z0eS.png" alt="" /></p>

<p>However, in order to improve lookups performance, some optimizations need to be applied. Therefore, with optimized 
operations, the resulting structure after (1) and (2) is:</p>

<p><img src="http://i.imgur.com/9srckn2.png" alt="" /></p>

<p>Each set is a tree represented by its <em>root</em>. Therefore, looking for the set an element belongs to is not more than 
following its parental relations until the root of the tree is reached. So the shallower the tree is, the fewer
the operations to be performed in the lookup are.</p>

<p>On the other hand, the operation where two sets are merged (<em>union</em>) consist on making one of the two trees to become a 
branch of the other:</p>

<p><img src="http://i.imgur.com/aKHPrtV.png" alt="" /></p>

<h3 id="heuristics">Heuristics</h3>

<p>These are two optimizations whose goal is to reduce the depth of each tree representing a set. The lower the tree height is, 
the fewer operations are needed to find one element set  label.</p>

<p>Considering <code class="highlighter-rouge">DisjointSets</code> structure as a forest of tree-sets, let’s compute <img src="http://i.imgur.com/wgbq86Y.png" alt="" /> as the maximum tree height of the 
forest.
The maximum number of operations to complete before finding one element in one set is proportional to the number of 
jumps from the deepest leaf to its tree root. That is <img src="http://i.imgur.com/DR5IUP3.png" alt="" />.</p>

<p>There are two heuristics designed to keep these tress low:</p>

<ul>
  <li><strong>Union by rank:</strong>  Avoids incrementing <img src="http://i.imgur.com/DR5IUP3.png" alt="" /> whenever possible. The idea is for each 
value node to store how many levels have the sub-tree that they are ancestor of (call it rank). All new elements 
have a rank value of 0 (the <em>root</em> is the first level). This way, whenever an <em>union</em> operation is 
executed, is the shorter tree the one that becomes a branch of the other and, therefore, <img src="http://i.imgur.com/DR5IUP3.png" alt="" /> does not increase.</li>
  <li><strong>Path compression:</strong> In this case the aim is to take advantage of the jumps made in <em>find</em> operation. Whenever a tree 
<em>root</em> is found it is assigned to every node in the search path. This is a purely functional data structure so the 
changes are reflected in a new copy of it which forms part of the operation result.</li>
</ul>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/dogs/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'stew/dogs'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/dogs/js/main.js"></script><script src="/dogs/js/kazari.js"></script><script>
$(document).ready(function() {
	kazari.KazariPlugin().decorateCode('https://scala-evaluator-212.herokuapp.com/eval', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.S2F6YXJp.Jl2eqMfw8IakJF93PjxTbrf-8YUJgX5OoOfy5JHE8Yw', '', 'monokai')
})
    </script></body></html>