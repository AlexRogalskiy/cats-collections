<!DOCTYPE html><html><head><title>cats-collections: DisjointSets</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="org.typelevel" /><meta name="description" content="pure functional data structures for Scala" /><meta name="og:image" content="/cats-collections/img/poster.png" /><meta name="image" property="og:image" content="/cats-collections/img/poster.png" /><meta name="og:title" content="cats-collections: DisjointSets" /><meta name="title" property="og:title" content="cats-collections: DisjointSets" /><meta name="og:site_name" content="cats-collections" /><meta name="og:url" content="http://typelevel.org/cats-collections/" /><meta name="og:type" content="website" /><meta name="og:description" content="pure functional data structures for Scala" /><link rel="icon" type="image/png" href="/cats-collections/img/favicon.png" /><meta name="twitter:title" content="cats-collections: DisjointSets" /><meta name="twitter:image" content="/cats-collections/img/poster.png" /><meta name="twitter:description" content="pure functional data structures for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/cats-collections/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/cats-collections/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/cats-collections/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/cats-collections/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/cats-collections/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/cats-collections/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/cats-collections/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/cats-collections/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/cats-collections/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/cats-collections/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/cats-collections/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/cats-collections/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/cats-collections/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/cats-collections/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/cats-collections/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/cats-collections/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/cats-collections/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/cats-collections/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/cats-collections/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/cats-collections/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/cats-collections/highlight/styles/vs.css" /><link rel="stylesheet" href="/cats-collections/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/cats-collections/" class="brand"><div class="brand-wrapper"></div><span>cats-collections</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/cats-collections/index.html" title="Home" class="">Home</a></div> <div class="sidebar-nav-item  "><a href="/cats-collections/binaryheap.html" title="Binary Heap" class="">Binary Heap</a></div> <div class="sidebar-nav-item  "><a href="/cats-collections/dequeue.html" title="Dequeue" class="">Dequeue</a></div> <div class="sidebar-nav-item  "><a href="/cats-collections/diet.html" title="Diet" class="">Diet</a></div> <div class="sidebar-nav-item  "><a href="/cats-collections/discrete.html" title="Discrete" class="">Discrete</a></div> <div class="sidebar-nav-item active "><a href="/cats-collections/disjointsets.html" title="Disjoint Sets" class="active">Disjoint Sets</a></div> <div class="sidebar-nav-item  "><a href="/cats-collections/predicate.html" title="Predicate" class="">Predicate</a></div> <div class="sidebar-nav-item  "><a href="/cats-collections/range.html" title="Range" class="">Range</a></div> <div class="sidebar-nav-item  "><a href="/cats-collections/set.html" title="AvlSet" class="">AvlSet</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/typelevel/cats-collections" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/typelevel/cats-collections" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="typelevel" data-github-repo="cats-collections"><div class="content-wrapper"><section><h1 id="disjoint-sets">Disjoint Sets</h1>

<p><code class="language-plaintext highlighter-rouge">DisjointSets</code> provides a purely functional implementation for the union-find collection.
An Union-Find (aka Disjoint Sets) structure is a set of sets where the intersection of any two sets is empty.</p>

<p><img src="http://i.imgur.com/K7BwoOk.png" alt="" /></p>

<p><img src="http://i.imgur.com/SkqEdwt.png" alt="" /></p>

<p>This constraint opens the way to fast unions (<code class="language-plaintext highlighter-rouge">O(1)</code> average). That makes of Disjoint Sets the perfect tool for
 clustering algorithms such as calculating the connected components in a graph.</p>

<p>Initially, it is a flat collection where each element forms its own, size 1, disjoint set.
New elements are added as new disjoint sets and union operations can be used to fusion these sets.
The joined sets are represented by one of its elements known as <strong><em>label</em> or <em>root</em></strong>.</p>

<p>Fast fusion of disjoints sets is key and its provided through parenthood relations. Sets <code class="language-plaintext highlighter-rouge">labels</code> are always the
top-level ancestor.</p>

<p>The following example shows 3 disjoint sets of size 1.</p>

<p><img src="http://i.imgur.com/h8ddOkT.png" alt="" /></p>

<p>Whereas, in the next one, <code class="language-plaintext highlighter-rouge">C</code> is the parent of the <code class="language-plaintext highlighter-rouge">{A, B, C}</code> set which is the only set in the DisjointSets structure.</p>

<p><img src="http://i.imgur.com/V71Z0eS.png" alt="" /></p>

<h2 id="supported-operations">Supported operations</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">dsets + c</code> (add): Adds a value as a single element set:</li>
</ul>

<p><img src="http://i.imgur.com/iA00VgQ.png" alt="" /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">desets.union(A,C)</code> (union/join): Fusion two disjoint sets:</li>
</ul>

<p><img src="http://i.imgur.com/7uunsNJ.png" alt="" /></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dsets.find(v)</code> (find): Retrieves <code class="language-plaintext highlighter-rouge">Some(label)</code> if <code class="language-plaintext highlighter-rouge">v</code> belongs to the set with that label or <code class="language-plaintext highlighter-rouge">None</code> if the
value is not part of <code class="language-plaintext highlighter-rouge">dsets</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dsets.toSets</code>: Gets a <code class="language-plaintext highlighter-rouge">Map[T, Set[T]]</code> representation of the DisjointSets contents where the key is each set
<em>label</em>.</p>
  </li>
</ul>

<h2 id="example-usage">Example usage</h2>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">DisjointSets._</span>

<span class="k">val</span> <span class="nv">operations</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nf">union</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span>
  <span class="n">oneAndTwo</span> <span class="k">&lt;-</span> <span class="nf">find</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nf">union</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">)</span>
  <span class="n">threeAndFour</span> <span class="k">&lt;-</span> <span class="nf">find</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nf">union</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">)</span>
  <span class="n">sets</span> <span class="k">&lt;-</span> <span class="n">toSets</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">sets</span>

<span class="k">val</span> <span class="nv">label2disjointset</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Set</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span> <span class="nv">operations</span><span class="o">.</span><span class="py">runA</span><span class="o">(</span><span class="nc">DisjointSets</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">)).</span><span class="py">value</span>
</code></pre></div></div>

<h2 id="structure-and-performance">Structure and performance</h2>

<p>The main idea is that each element starts as a disjoint set itself. A set with two or more elements is always the result of one or several <em>union</em> operations. Thus, a multi-element set is composed of sets of just one element, call them components.</p>

<p>Each component has 3 fields:</p>

<ul>
  <li>One for the value of the element it contains.</li>
  <li>A reference pointing to another component of the same composed multi-element set. Or itself if it constitutes a single element set.</li>
  <li>An estimation of how many components/nodes compose its descendants. This estimation is known as <strong>rank</strong>.</li>
</ul>

<p>Let’s assume that the next operations are executed:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsets.union(B,A) //1
dsets.union(B,C) //2
</code></pre></div></div>

<p>From a mathematical point of view, the result should be similar to the one shown below:</p>

<p><img src="http://i.imgur.com/V71Z0eS.png" alt="" /></p>

<p>However, in order to improve lookups performance, some optimizations need to be applied. Therefore, with optimized
operations, the resulting structure after (1) and (2) is:</p>

<p><img src="http://i.imgur.com/9srckn2.png" alt="" /></p>

<p>Each set is a tree represented by its <em>root</em>. Therefore, looking for the set an element belongs to is not more than
following its parental relations until the root of the tree is reached. So the shallower the tree is, the fewer
the operations to be performed in the lookup are.</p>

<p>On the other hand, the operation where two sets are merged (<em>union</em>) consist on making one of the two trees to become a
branch of the other:</p>

<p><img src="http://i.imgur.com/aKHPrtV.png" alt="" /></p>

<h3 id="heuristics">Heuristics</h3>

<p>These are two optimizations whose goal is to reduce the depth of each tree representing a set. The lower the tree height is,
the fewer operations are needed to find one element set  label.</p>

<p>Considering <code class="language-plaintext highlighter-rouge">DisjointSets</code> structure as a forest of tree-sets, let’s compute <img src="http://i.imgur.com/wgbq86Y.png" alt="" /> as the maximum tree height of the
forest.
The maximum number of operations to complete before finding one element in one set is proportional to the number of
jumps from the deepest leaf to its tree root. That is <img src="http://i.imgur.com/DR5IUP3.png" alt="" />.</p>

<p>There are two heuristics designed to keep these tress low:</p>

<ul>
  <li><strong>Union by rank:</strong>  Avoids incrementing <img src="http://i.imgur.com/DR5IUP3.png" alt="" /> whenever possible. The idea is for each
value node to store how many levels have the sub-tree that they are ancestor of (call it rank). All new elements
have a rank value of 0 (the <em>root</em> is the first level). This way, whenever an <em>union</em> operation is
executed, is the shorter tree the one that becomes a branch of the other and, therefore, <img src="http://i.imgur.com/DR5IUP3.png" alt="" /> does not increase.</li>
  <li><strong>Path compression:</strong> In this case the aim is to take advantage of the jumps made in <em>find</em> operation. Whenever a tree
<em>root</em> is found it is assigned to every node in the search path. This is a purely functional data structure so the
changes are reflected in a new copy of it which forms part of the operation result.</li>
</ul>
</section></div></div></div></div><script src="/cats-collections/highlight/highlight.pack.js"></script><script src="/cats-collections/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'typelevel/cats-collections'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/cats-collections/js/search.js"></script><script src="/cats-collections/js/docs.js"></script></body></html>